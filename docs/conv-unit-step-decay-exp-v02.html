<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Convolution Visualization</title>
  https://cdn.plot.ly/plotly-latest.min.js</script>
  <!-- Load MathJax for LaTeX rendering -->
  <script>
    window.MathJax = {
      tex: {inlineMath: [['$', '$'], ['\\(', '\\)']]}
    };
  </script>
  https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js</script>
  <style>
    body {
      font-family: sans-serif;
      margin: 20px;
      line-height: 1.5;
    }
    .grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      max-width: 1500px;
    }
    .plot {
      width: 100%;
      height: 350px;
    }
    .control {
      margin-top: 20px;
      margin-bottom: 20px;
      font-size: 16px;
    }
    input[type=range] {
      width: 400px;
      vertical-align: middle;
    }
    #tValue {
      font-weight: bold;
      margin-left: 8px;
    }
    h3 {
      margin-bottom: 5px;
      margin-top: 15px;
    }
  </style>
</head>
<body>

<h2>Convolution: Unit Step and Exponential Decay</h2>

<p>We illustrate convolution using the unit step function $u(t)$ and an exponentially decaying function.  
Here, $f(t) = u(t)$ and $g(t) = u(t) e^{-t}$.</p>

<p>The convolution integral is
  $$(f*g)(t) = \int_{-\infty}^{\infty} f(\tau)\, g(t-\tau)\, d\tau,$$
  so we demonstrate this in four steps:</p>

<ol>
  <li>Show the two functions to be convolved, $f(t)$ and $g(t)$.</li>
  <li>Show the functions in the $\tau$-domain:
    <ol>
      <li>The function $f(\tau)$</li>
      <li>The $\tau$-reversed and $t$-shifted $g(t-\tau)$ for a specific value of $t$.</li>
    </ol>
  </li>
  <li>Show the product $f(\tau) g(t - \tau)$, whose area is the value of the convolution integral at $t$.</li>
  <li>Show the value of the convolution integral at times $t$.</li>
</ol>

<div class="grid">
  <div>
    <h3>1. The functions $f(t)$ and $g(t)$</h3>
    <p>Here, $f(t) = u(t)$ and $g(t) = u(t) e^{-t}$.</p>
    <div id="plot1" class="plot"></div>
  </div>

  <div>
    <h3>2. The shifted/reversed function $g(-\tau + t)$</h3>
    <p>We compare $f(\tau)$ and $g(-\tau+t)$ as $t$ varies.</p>
    <div id="plot2" class="plot"></div>

    <div class="control">
      <label for="tSlider">$t$:</label>
      <input type="range" id="tSlider" min="-5" max="10" step="0.1" value="0">
      <span id="tValue">0</span>
    </div>
  </div>

  <div>
    <h3>3. The product $f(\tau) g(-\tau+t)$</h3>
    <p>This shows the overlap of $f(\tau)$  and $g(t-\tau)$ for the specific value of $t$.</p>
    <div id="plot3" class="plot"></div>
  </div>

  <div>
    <h3>4. The convolution result $(f*g)(t)$</h3>
    <p>The convolution at time $t$ is the area under the curve $f(\tau)g(t-\tau)$.</p>
    <div id="plot4" class="plot"></div>
  </div>
</div>

<script>
// Heaviside step
function H(x) { return (x >= 0 ? 1 : 0); }

// Tau axis and t-values
const tau = Array.from({length: 1001}, (_, i) => -5 + i*0.01);
const tvals = Array.from({length: 1501}, (_, i) => -5 + i*0.01);

// g(t) = u(t) * exp(-t)
function g_of(x) {
  return H(x) * Math.exp(-x);
}

// Numerical convolution of f(τ) = u(τ) and g(τ) = u(τ) * exp(-τ)
function computeConvolution(f, g, dt) {
  const N = f.length;
  const result = new Array(N).fill(0);
  for (let t = 0; t < N; t++) {
    let sum = 0;
    for (let tau = 0; tau < N; tau++) {
      const idx = t - tau;
      if (idx >= 0 && idx < N) {
        sum += f[tau] * g[idx];
      }
    }
    result[t] = sum * dt;
  }
  return result;
}

// Precompute f(t), g(t), and convolution
const f_t = tvals.map(x => H(x));
const g_t = tvals.map(x => g_of(x));
const dt = tvals[1] - tvals[0];
const convData = computeConvolution(f_t, g_t, dt);

function updatePlots(t) {
  const f_tau = tau.map(x => H(x));
  const gShifted = tau.map(x => g_of(-x + t));
  const prod = tau.map((x, i) => f_tau[i] * gShifted[i]);

  // Plot 1: f(t) and g(t)
  Plotly.newPlot("plot1", [
    {x: tvals, y: f_t, mode: 'lines', name: "f(t) = u(t)", line: {color:'blue'}},
    {x: tvals, y: g_t, mode: 'lines', name: "g(t) = u(t)·e^{-t}", line: {color:'red', dash:'dash'}}
  ], {margin:{t:20}, yaxis:{range:[-0.25, 1.25]}});

  // Plot 2: f(τ) and g(-τ+t)
  Plotly.newPlot("plot2", [
    {x: tau, y: f_tau, mode: 'lines', name: "f(τ)", line: {color:'blue'}},
    {x: tau, y: gShifted, mode: 'lines', name: "g(-τ+t)", line: {color:'red'}},
    {x: [t, t], y: [-0.25, 1.25], mode: 'lines', name: "t", line: {color:'black', dash:'dash'}}
  ], {margin:{t:20}, yaxis:{range:[-0.25, 1.25]}});

  // Plot 3: product
  Plotly.newPlot("plot3", [
    {x: tau, y: prod, mode: 'lines', name: "f(τ)g(-τ+t)", line: {color:'green'}}
  ], {margin:{t:20}, yaxis:{range:[-0.25, 1.25]}});

  // Plot 4: convolution
  Plotly.newPlot("plot4", [
    {x: tvals, y: convData, mode: 'lines', name: "(f*g)(t)", line: {color:'red'}},
    {x: [t, t], y: [-0.5, 1.5], mode: 'lines', name: "t", line: {color:'black', dash:'dash'}}
  ], {margin:{t:20}, xaxis:{range:[-5, 5]}, yaxis:{range:[-0.5, 1.5]}});
}

// Initialize
let t = 0;
updatePlots(t);

// Slider handler
const slider = document.getElementById("tSlider");
const tLabel = document.getElementById("tValue");
slider.addEventListener("input", function() {
  t = parseFloat(this.value);
  tLabel.textContent = t.toFixed(2);
  updatePlots(t);
});
</script>

</body>
</html>
